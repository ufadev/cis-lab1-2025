# –û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ GitHub Actions Workflow

## –î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
$(date)

## –§–∞–π–ª
`.github/workflows/ci.yml`

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å YAML
- –°–∏–Ω—Ç–∞–∫—Å–∏—Å YAML –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- –í—Å–µ –æ—Ç—Å—Ç—É–ø—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
- –ù–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

### ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ workflow
- **–ù–∞–∑–≤–∞–Ω–∏–µ**: CI Pipeline
- **–¢—Ä–∏–≥–≥–µ—Ä—ã**: 
  - Push –≤ –≤–µ—Ç–∫–∏: main, master, develop
  - Pull Request –≤ –≤–µ—Ç–∫–∏: main, master, develop
- **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**: 
  - contents: read
  - pages: write
  - id-token: write

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –®–∞–≥ –Ω–∞ —Å—Ç—Ä–æ–∫–µ 48
   - **–ë—ã–ª–æ**: `name: Setup .NET` (–Ω–æ –≤—ã–ø–æ–ª–Ω—è–ª `dotnet restore`)
   - **–°—Ç–∞–ª–æ**: `name: Restore .NET dependencies`
   - **–ü—Ä–∏—á–∏–Ω–∞**: –ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–≥–∞ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–æ –≤—ã–ø–æ–ª–Ω—è–µ–º–æ–º—É –¥–µ–π—Å—Ç–≤–∏—é

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∞–≥–æ–≤ workflow

#### 1. Checkout code
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `actions/checkout@v4`
- ‚úÖ `fetch-depth: 0` –¥–ª—è –ø–æ–ª–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –∫–æ–º–º–∏—Ç–æ–≤

#### 2. Setup .NET
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `actions/setup-dotnet@v4`
- ‚úÖ –í–µ—Ä—Å–∏—è: `8.0.x`

#### 3. Setup Node.js
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `actions/setup-node@v4`
- ‚úÖ –í–µ—Ä—Å–∏—è: `20`
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ npm –≤–∫–ª—é—á–µ–Ω–æ
- ‚ö†Ô∏è **–ó–∞–º–µ—á–∞–Ω–∏–µ**: `cache-dependency-path: frontend/package-lock.json` - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

#### 4. Restore frontend dependencies
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `npm ci` (–ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è CI)
- ‚úÖ `continue-on-error: true` - –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

#### 5. Run frontend tests
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞: `npm run test:allure -- --run`
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è: `ALLURE_RESULTS_DIR: allure-results`
- ‚úÖ `continue-on-error: true`

#### 6. Restore .NET dependencies
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞: `dotnet restore`
- ‚úÖ –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: `./backend`

#### 7. Run backend tests with Allure
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞: `dotnet test Tests/Tests.csproj`
- ‚úÖ –õ–æ–≥–≥–µ—Ä: `trx;LogFileName=../allure-results/results.trx`
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è: `ALLURE_RESULTS_DIR=allure-results`
- ‚úÖ `continue-on-error: true`

#### 8. Download Allure CLI
- ‚úÖ –°–∫–∞—á–∏–≤–∞–µ—Ç Allure 2.24.1
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤ `/opt/allure`
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç —Å–∏–º–ª–∏–Ω–∫ –≤ `/usr/local/bin/allure`

#### 9. Convert TRX to Allure JSON
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∫—Ä–∏–ø—Ç: `scripts/convert_trx_to_allure.py`
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏: `|| true`

#### 10. Download Allure history
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `actions/download-artifact@v4`
- ‚úÖ `continue-on-error: true`

#### 11. Prepare Allure history
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏

#### 12. Generate Allure Report
- ‚úÖ –ö–æ–ø–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ frontend
- ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç—á–µ—Ç —Å –∏—Å—Ç–æ—Ä–∏–µ–π
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª—É—á–∞–π –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

#### 13. Save Allure history
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–ø—É—Å–∫–∞
- ‚úÖ `if: always()` - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞

#### 14. Upload Allure Report
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `actions/upload-artifact@v4`
- ‚úÖ Retention: 30 –¥–Ω–µ–π

#### 15. Upload Allure history
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `actions/upload-artifact@v4`
- ‚úÖ Retention: 90 –¥–Ω–µ–π
- ‚úÖ `if-no-files-found: ignore`

#### 16. Deploy Allure Report to GitHub Pages
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `peaceiris/actions-gh-pages@v3`
- ‚úÖ –£—Å–ª–æ–≤–∏–µ: —Ç–æ–ª—å–∫–æ –¥–ª—è main/master –≤–µ—Ç–æ–∫
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `GITHUB_TOKEN`

### ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **package-lock.json**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª `frontend/package-lock.json` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
   - –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `pnpm` –∏–ª–∏ `yarn`, –∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—ç—à–∞

2. **–°–∫—Ä–∏–ø—Ç convert_trx_to_allure.py**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ `scripts/`
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Python 3 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ runner

3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è–º:
     - `frontend/` - React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
     - `backend/` - .NET –ø—Ä–æ–µ–∫—Ç
     - `scripts/` - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

4. **GitHub Pages**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ GitHub Pages –≤–∫–ª—é—á–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
   - –ò—Å—Ç–æ—á–Ω–∏–∫: GitHub Actions

5. **–¢–µ—Å—Ç—ã**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–µ—Å—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Allure –æ—Ç—á–µ—Ç–æ–≤:
     - Frontend: `allure-vitest` —Ä–µ–ø–æ—Ä—Ç–µ—Ä
     - Backend: `allure.xunit` –ø–∞–∫–µ—Ç

### üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

1. **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å act**
   ```bash
   act push
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞**
   ```bash
   yamllint .github/workflows/ci.yml
   ```

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ GitHub**
   - –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–º–º–∏—Ç
   - –°–æ–∑–¥–∞–π—Ç–µ Pull Request
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ workflow –≤ Actions

### ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

**–°—Ç–∞—Ç—É—Å**: ‚úÖ Workflow –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: 1 –ø—Ä–æ–±–ª–µ–º–∞ (–Ω–∞–∑–≤–∞–Ω–∏–µ —à–∞–≥–∞)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

